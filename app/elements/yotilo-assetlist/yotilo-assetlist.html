<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<dom-module id="yotilo-assetlist">
    <template>
        <style>
        :host {}
        
        button {
            height: 5rem;
            border: var(--color-border) 1px solid;
            background: #FFF;
            border-radius: 4px;
            padding: 0 2rem;
            box-shadow: var(--shadow);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: .05em;
            font-weight: 600;
            outline: none;
            cursor: pointer;
        }
        
        div {
            position: relative;
        }
        
        div input {
            height: 7rem;
            line-height: 7rem;
            background: #FFF;
            width: 100%;
            display: block;
            border: 0;
            border-radius: 4px;
            padding: 0 2rem;
            outline: none;
            box-sizing: border-box;
            font-size: 14px;
        }
        
        div:hover input {
            background: #EEE;
        }
        
        div:hover button {
            opacity: 1;
        }
        
        div input:focus {
            background: #EEE;
        }
        
        div button {
            opacity: 0;
            position: absolute;
            top: 50%;
            right: 1rem;
            transform: translateY(-50%);
            transition: all 250ms ease;
        }
        
        div button:hover {
            opacity: 1;
        }
        
        button.new {
            margin: 1.5rem 0 0 0;
        }
        </style>
        <iron-localstorage name$="[[asset]]" value="{{data}}" on-iron-localstorage-load-empty="_initAsset"></iron-localstorage>
        <template is="dom-repeat" items="{{data}}" filter="_filter" observe="state">
            <div>
                <input type="text" value$="{{item.title}}" on-blur="_save" on-keydown="_keydown">
                <button on-tap="_archive">
                    Archive Entry
                </button>
            </div>
        </template>
        <button class="new" on-tap="_newEntry">
            Add Entry
        </button>
    </template>
    <script>
    Polymer({
        is: 'yotilo-assetlist',

        properties: {
            asset: {
                type: String
            },
            data: {
                type: Array,
                value: [],
                notify: true
            }
        },

        ready: function() {

        },

        _newEntry: function() {

            this.push('data', {
                id: 'id' + (new Date().getTime()),
                title: '',
                state: 1,
                createdAt: (new Date().getTime())
            });
        },

        _initAsset: function() {
            this.set('data', []);
        },

        _save: function(e) {
            e.model.set('item.title', e.target.value);
        },

        _keydown: function(e) {
            if (e.keyCode == 13) {
                e.target.blur();
            }
        },

        _archive: function(e) {
            e.model.set('item.state', 2);
        },

        _filter: function(item) {
            return item.state == 1;
        }
    });
    </script>
</dom-module>
